(fn[r f &%](r #(r(fn[m[% v]](assoc m%(if(m%)(f(m%)v)v)))%%2)%))reduce