(fn[r f &%](r #(r(fn[m[k%]](assoc m k(if-let[b(m k)](f b%)%)))%%2)%))reduce